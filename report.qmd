---
title: "Project title"
subtitle: "Report"
format: html
editor: visual
execute:
  echo: false
---

```{r}
#|: libraries

library(tidyverse)
library(tidymodels)
library(ggplot2)
```

**Introduction and Data**

How has the rate of marijuana and tobacco use changed from 2013 to 2018 in 18-25 year olds in North Carolina (where marijuana is illegal) and Colorado (where marijuana was legalized in 2013), and is there a significant difference between the change in marijuana and tobacco use in the two states? Given the recent increase in legalization of cannabis (Forbes) and the increase in tobacco prevention education (Tobacco Free Kids) in the past several decades, we were interested to see if marijuana usage has been increasing and tobacco usage has been decreasing among 18-25 year olds (which is our age range) from 2013 to 2018.

Our dataset contains alcohol, cigarette, cocaine, marijuana, and tobacco use statistics for all 50 states and the District of Columbia from 2002 - 2018, broken down into three age ranges: 12-17, 18-25, and 26+. The data comes from CORGIS: The Collection of Really Great, Interesting, Situated Datasets, and was originally stored in the Substance Abuse & Mental Health Data Archive (SAMHDA). The data was gathered from the annual National Survey on Drug Use and Health. There are 53  variables, including state, year, and usage (totals and rates) of various drugs for each age group. The dataset includes 867 total observations.

As mentioned earlier, we chose to focus on Colorado because marijuana was legalized there and North Carolina because that\'s where we are. Therefore, we filtered the dataset for just those two states. In addition, since we are investigating marijuana and tobacco usage among 18-25 year olds we selected just marijuana usage rates and tobacco usage rates for 18-25 year olds among all the drug use data that was included. Finally, several variables were renamed and a new variable \"years since legalization\" was created to represent the number of years that had passed since marijuana legalization in Colorado in 2013.  

It is important to consider the ethical concerns and biases that may be present in the collection of this data. Since our data comes from a voluntary response sample, it may not be entirely accurate because people can choose to not respond or to respond inaccurately, especially when regarding a topic such as drug use that has legal implications. 

```{r}
#|: data

drugs <- read_csv("data/drugs.csv")

```

```{r}
#| label: clean-data

new_drugs <- drugs |>
  rename("Tobacco" = "Rates.Tobacco.Cigarette Past Month.18-25") |>
  rename("Marijuana" = "Rates.Marijuana.Used Past Month.18-25") |>
  select("State", "Year", "Tobacco", "Marijuana") |>
  filter(Year > 2012) |>
  filter(State == "Colorado" | State == "North Carolina") |>
  mutate(yrs_since_legal = Year-2013)
```

**Literature Review**

A study done from 2008 - 2016 investigated whether increases in recreational marijuana legalization led to any changes in marijuana use and cannabis use disorder. The study also used data from the National Survey on Drug Use and Health, and looked at the states of Colorado, Washington, Alaska, and Oregon because of their recent recreational marijuana legalization and compared them to other \"control\" states where recreational marjuana has not been legalized. To examine if there were differences in marijuana usage after its legalization, the authors looked at the three age ranges of 12-17 years old, 18-25 years old, and 26+ years old and constructed logistic regression models that measured before vs after changes in variables such as self reported past month marijuana use, frequent marijuana use, and cannabis use disorder. They found that for 12-17 year olds, legalization of marijuana led to an increase in cannabis use disorder, and for 26+ year olds past month marijuana usage increased. However, for 18-25 year olds there were no significant increases in marijuana use or cannabis use disorder. This study is related to our research because it also looks at the effects of marijuana legalization. However, our study adds to this work by also examining whether marijuana legalization has any impact on tobacco usage as well. 

Source: Cerdá, Magdalena et al. \"Association Between Recreational Marijuana Legalization in the United States and Changes in Marijuana Use and Cannabis Use Disorder From 2008 to 2016.\" *JAMA Psychiatry*, vol. 77, no. 2, Nov. 2019, doi:10.1001/jamapsychiatry.2019.3254.

\newpage

**Methodolgy**

```{r}
#|: EDA-marijuana

new_drugs |>
  ggplot(aes(x = Year, y = Marijuana, color = State)) +
  geom_point() +
  labs(title = "Marijuana Usage in CO and NC (2013 - 2018)", 
       subtitle = "18 - 25 Year Olds", 
       x = "Year",
       y = "% of Population Using Marijuana",
       caption = "Source: SAMHDA") +
  theme(legend.position="bottom") +
  geom_smooth(method = "lm", se = FALSE) +
  scale_y_continuous(labels = scales::percent)

```

```{r}
#|: EDA-tobacco

new_drugs |>
  ggplot(aes(x = Year, y = Tobacco, color = State)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Tobacco Usage in CO and NC (2013 - 2018)", 
       subtitle = "18 - 25 Year Olds", 
       x = "Year",
       y = "% of Population Using Tobacco",
       caption = "Source: SAMHDA") +
  theme(legend.position="bottom") +
  geom_smooth(method = "lm", se = FALSE) +
  scale_y_continuous(labels = scales::percent)

```

To explore our research question, we conducted two hypothesis tests for a difference in the regression coefficients (the difference in the rate of change) of marijuana usage and tobacco usage in Colorado and North Carolina. To do this, we built two interaction models that examined the interaction effect that the state (CO or NO) and explanatory variable (years since legalization) had on the response variable (marijuana usage rate, tobacco usage rate. We then used the p-value of the interaction term given by the model in our hypothesis test.

\newpage

**Hypothesis Test for Marijuana**

$H_0:\beta_{Col\_mar} - \beta_{NC\_mar} = 0$

$H_a:\beta_{Col\_mar} - \beta_{NC\_mar} > 0$

Null hypothesis: There is no difference in the rate of increase in marijuana usage in Colorado and North Carolina between 2013-2018

Alternative Hypothesis: The increase in marijuana usage in Colorado is greater than the increase in marijuana usage in North Carolina from 2013-2018

```{r}
#|: int-model-marijuana

int_model_mar <- linear_reg() |>
  set_engine("lm") |>
  fit(Marijuana ~ yrs_since_legal * State, data = new_drugs)

tidy(int_model_mar)
```

\newpage

**Hypothesis Test for Tobacco:**

$H_0:\beta_{Col\_tob} - \beta_{NC\_tob} = 0$

$H_a:\beta_{Col\_tob} - \beta_{NC\_tob} < 0$

Null hypothesis: There is no difference in the rate of decrease in tobacco usage in Colorado and North Carolina from 2013-2018

Alternative Hypothesis: The decrease in tobacco usage in Colorado is greater than the decrease in tobacco usage in North Carolina from 2013-2018

```{r}
#|: hypothesis-test-tobacco

int_model_tob <- linear_reg() |>
  set_engine("lm") |>
  fit(Tobacco ~ yrs_since_legal * State, data = new_drugs)

tidy(int_model_tob)
```

\newpage

```{r}
#|: Predictions-marijuana

nc_mar_pred <- predict(int_model_mar, 
                data.frame(yrs_since_legal = 9, State = "North Carolina")) |>
                pull()
co_mar_pred <- predict(int_model_mar, 
                data.frame(yrs_since_legal = 9, State = "Colorado")) |>
                pull()
m_pred <- c(nc_mar_pred, co_mar_pred)
states <- c("North Carolina", "Colorado")
graph1 <- data.frame(m_pred, states)

graph1 |>
  ggplot(aes(x = states, y = m_pred)) +
  geom_bar(stat = "identity", fill = "dark green") +
  labs(x = "State", y = "Predicted % Using Marijuana",
       title = "Predicted % of 18 - 25 Year Olds Using Marijuana (2023)",
       subtitle = "Colorado & North Carolina") +
    scale_y_continuous(labels = scales::percent) + 
  theme_bw()

```

```{r}
#|: Predictions-tobacco

nc_tob_pred <- predict(int_model_tob, 
                data.frame(yrs_since_legal = 9, State = "North Carolina")) |>
                pull()

co_tob_pred <- predict(int_model_tob, 
                data.frame(yrs_since_legal = 9, State = "Colorado")) |>
                pull()

t_pred <- c(nc_tob_pred, co_tob_pred)
graph2<- data.frame(t_pred, states)

graph2 |>
  ggplot(aes(x = states, y = t_pred)) +
  geom_bar(stat = "identity", fill = "darkorange") +
  labs(x = "State", y = "Predicted % Using Tobacco",
       title = "Predicted % of 18 - 25 Year Olds Using Tobacco (2023)",
       subtitle = "Colorado & North Carolina") +
    scale_y_continuous(labels = scales::percent) +
  theme_bw()

```

**Results**

**`Regression Equations`**

Marijuana usage in Colorado after legalization (2013 - 2018):

$CO\_marijuana\_usage\_rate = 0.3101 + 0.0056 * year$

Marijuana usage in North Carolina 2013 - 2018:

$NC\_marijuana\_usage\_rate = 0.1768 + 0.0045 * year$

$year$ = number of years since marijuana legalization in Colorado (2013)

p-value of interaction between explanatory variable (year) and category (state: NC/CO): 0.73

Tobacco usage in Colorado after marijuana legalization (2013 - 2018):

$CO\_tobacco\_usage\_rate = 0.3201 - 0.0237 * year$

Tobacco usage in North Carolina 2013 - 2018:

$NC\_tobacco\_usage\_rate = 0.3070 - 0.0193 * year$

$year$ = number of years since marijuana legalization in Colorado (2013)

p-value of interaction between explanatory variable (year) and category (state: NC/CO): 0.4

For both of our hypothesis tests, the p-value of the interaction between our explanatory variable (the number of years since marijuana legalization in Colorado in 2013) and our category (the two states Colorado and North Carolina) was much higher than our chosen significance level of 0.05. Therefore, we failed to reject the null hypothesis that there is no difference in the rate of increase in marijuana usage and the rate of decrease in tobacco usage between North Carolina and Colorado. 

\newpage

**Discussion**
